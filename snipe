local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")
local player = Players.LocalPlayer

local allowedUserIds = {
    [0] = true,
    [0] = true,
    [0] = true,
    [0] = true,
    [1701401032] = true,
    [7785950571] = true,
    [1394697627] = true,
    [3859777415] = true,
    [2599550082] = true,
    [1263973763] = true,
}

if not allowedUserIds[player.UserId] then
    warn("âŒ You are not allowed to use this script.")
    return
end

-- âœ… Ù…Ø³Ù…ÙˆØ­ Ù„Ù‡ - Ù†ÙƒÙ…Ù„
local Marketplace = ReplicatedStorage:WaitForChild("Marketplace")

local MarketService = ReplicatedStorage:WaitForChild("Packages")
    :WaitForChild("_Index")
    :WaitForChild("sleitnick_knit@1.4.7")
    :WaitForChild("knit")
    :WaitForChild("Services")
    :WaitForChild("MSiAk3wjaj")

local BuyRF = MarketService:WaitForChild("RF"):WaitForChild("Buy")
local ItemRefreshed = MarketService:WaitForChild("RE"):WaitForChild("ItemRefreshed")

local snipingEnabled = true

-- ğŸ¯ Auto Buy Function
local function autoBuyItem(item)
    if not snipingEnabled then return end
    task.spawn(function()
        local itemId = item.Name
        local releaseTime = tonumber(item:GetAttribute("releaseTime"))
        local now = os.time()

        print("ğŸ“¦ Trying:", itemId, "Release:", releaseTime, "Now:", now)

        if not itemId then
            warn("âŒ No itemId")
            return
        end

        if releaseTime and now < releaseTime then
            print("â³ Waiting until release:", itemId)
            while os.time() < releaseTime do
                task.wait(0.1)
            end
        end

        local bought = 0
        while bought < 4 and snipingEnabled do
            local success, result = pcall(function()
                return BuyRF:InvokeServer(itemId)
            end)

            if success then
                bought += 1
                print("âœ… Bought:", itemId, "Attempt:", bought)
                task.wait(1.5)
            else
                warn("âŒ Failed:", result)
                task.wait(0.1)
            end
        end
    end)
end

-- ğŸŸ¢ Detect New Items
Marketplace.ChildAdded:Connect(function(item)
    print("ğŸŸ¢ New Item Detected:", item.Name)
    autoBuyItem(item)
end)

-- ğŸ”„ Refreshed Item Handler
ItemRefreshed.OnClientEvent:Connect(function(itemId)
    print("ğŸ”„ Item Refreshed:", itemId)
    local item = Marketplace:FindFirstChild(itemId)

    if not item then
        task.wait(0.2)
        item = Marketplace:FindFirstChild(itemId)
    end

    if item then
        local releaseTime = tonumber(item:GetAttribute("releaseTime"))
        local now = os.time()
        if releaseTime and now < releaseTime then
            print("â³ Waiting for refreshed release:", itemId)
            while os.time() < releaseTime do
                task.wait(0.1)
            end
        end
        autoBuyItem(item)
    else
        warn("âŒ Refreshed Item not found:", itemId)
    end
end)

-- ğŸ”ƒ Buy latest on join
local lastItem = nil
local lastTime = -math.huge

for _, item in Marketplace:GetChildren() do
    local releaseTime = tonumber(item:GetAttribute("releaseTime"))
    if releaseTime and releaseTime > lastTime then
        lastItem = item
        lastTime = releaseTime
    end
end

if lastItem then
    print("ğŸŸ¢ Buying last item at join:", lastItem.Name)
    autoBuyItem(lastItem)
else
    print("âŒ No item at join")
end

-- GUI Ø²Ø± Ø§Ù„Ø³Ù†Ø§ÙŠØ¨
local function createSnipeButton()
    local screenGui = Instance.new("ScreenGui")
    screenGui.Name = "SnipeToggleGUI"
    screenGui.ResetOnSpawn = false
    screenGui.Parent = player:WaitForChild("PlayerGui")

    local snipeButton = Instance.new("TextButton")
    snipeButton.Name = "ToggleButton"
    snipeButton.Text = "ğŸ”« Auto Snipe: ON"
    snipeButton.Size = UDim2.new(0, 180, 0, 50)
    snipeButton.Position = UDim2.new(0, 10, 0, 10) -- Ø£Ø¹Ù„Ù‰ Ø§Ù„ÙŠØ³Ø§Ø±
    snipeButton.BackgroundColor3 = Color3.fromRGB(34, 139, 34)
    snipeButton.TextColor3 = Color3.new(1, 1, 1)
    snipeButton.Font = Enum.Font.GothamBold
    snipeButton.TextSize = 16
    snipeButton.BorderSizePixel = 0
    snipeButton.BackgroundTransparency = 0.1
    snipeButton.AutoButtonColor = true
    snipeButton.Parent = screenGui
    Instance.new("UICorner", snipeButton).CornerRadius = UDim.new(0.2, 0)

    snipeButton.MouseButton1Click:Connect(function()
        snipingEnabled = not snipingEnabled
        if snipingEnabled then
            snipeButton.Text = "ğŸ”« Auto Snipe: ON"
            snipeButton.BackgroundColor3 = Color3.fromRGB(34, 139, 34)
            print("âœ… Auto Snipe: ON")
        else
            snipeButton.Text = "ğŸ”« Auto Snipe: OFF"
            snipeButton.BackgroundColor3 = Color3.fromRGB(178, 34, 34)
            print("â›” Auto Snipe: OFF")
        end
    end)
end

-- Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø²Ø± ÙÙ‚Ø· Ø¥Ø°Ø§ Ù…Ø³Ù…ÙˆØ­
createSnipeButton()
