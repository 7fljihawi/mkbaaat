local Players = game:GetService("Players")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local Marketplace = ReplicatedStorage:WaitForChild("Marketplace")

local MarketService = ReplicatedStorage:WaitForChild("Packages")
	:WaitForChild("_Index")
	:WaitForChild("sleitnick_knit@1.4.7")
	:WaitForChild("knit")
	:WaitForChild("Services")
	:WaitForChild("MSiAk3wjaj")

local BuyRF = MarketService:WaitForChild("RF"):WaitForChild("Buy")
local ItemRefreshed = MarketService:WaitForChild("RE"):WaitForChild("ItemRefreshed")

-- Ø¯Ø§Ù„Ø© Ø§Ù„Ø´Ø±Ø§Ø¡
local function autoBuyItem(item)
	task.spawn(function()
		local itemId = item.Name
		local releaseTime = tonumber(item:GetAttribute("releaseTime"))
		local now = os.time()

		print("ğŸ“¦ Trying:", itemId, "Release:", releaseTime, "Now:", now)

		if not itemId then
			warn("âŒ No itemId")
			return
		end

		if releaseTime and now < releaseTime then
			print("â³ Waiting until release:", itemId)
			while os.time() < releaseTime do
				task.wait(0.1)
			end
		end

		local bought = 0
		while bought < 61 do
			local success, result = pcall(function()
				return BuyRF:InvokeServer(itemId)
			end)

			if success then
				bought += 1
				print("âœ… Bought:", itemId, "Attempt:", bought)
				task.wait(0.1)
			else
				warn("âŒ Failed:", result)
				task.wait(0.1)
			end
		end
	end)
end

-- ÙŠØ´ØªØ±ÙŠ Ø£ÙŠ Ø£ÙŠØªÙ… Ø¬Ø¯ÙŠØ¯
Marketplace.ChildAdded:Connect(function(item)
	print("ğŸŸ¢ New Item Detected:", item.Name)
	autoBuyItem(item)
end)

-- ÙŠØ´ØªØ±ÙŠ Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ø¯ÙŠØ« Ù…Ø¹ Ø§Ù†ØªØ¸Ø§Ø± Ù„Ùˆ Ù…Ùˆ Ø¬Ø§Ù‡Ø²
ItemRefreshed.OnClientEvent:Connect(function(itemId)
	print("ğŸ”„ Item Refreshed:", itemId)
	local item = Marketplace:FindFirstChild(itemId)

	if not item then
		task.wait(0.2)
		item = Marketplace:FindFirstChild(itemId)
	end

	if item then
		local releaseTime = tonumber(item:GetAttribute("releaseTime"))
		local now = os.time()
		if releaseTime and now < releaseTime then
			print("â³ Waiting for refreshed release:", itemId)
			while os.time() < releaseTime do
				task.wait(0.1)
			end
		end
		autoBuyItem(item)
	else
		warn("âŒ Refreshed Item not found:", itemId)
	end
end)

-- Ø´Ø±Ø§Ø¡ Ø¢Ø®Ø± Ø£ÙŠØªÙ… Ø¹Ù†Ø¯ Ø§Ù„Ø¯Ø®ÙˆÙ„
local lastItem = nil
local lastTime = -math.huge

for _, item in Marketplace:GetChildren() do
	local releaseTime = tonumber(item:GetAttribute("releaseTime"))
	if releaseTime and releaseTime > lastTime then
		lastItem = item
		lastTime = releaseTime
	end
end

if lastItem then
	print("ğŸŸ¢ Buying last item at join:", lastItem.Name)
	autoBuyItem(lastItem)
else
	print("âŒ No item at join")
end

-- ğŸ›¡ï¸ Anti-AFK: ØªØ­Ø±ÙŠÙƒ Ø§Ù„Ù„Ø§Ø¹Ø¨ ÙƒÙ„ 5 Ø¯Ù‚Ø§Ø¦Ù‚
task.spawn(function()
	while true do
		task.wait(300) -- 5 Ø¯Ù‚Ø§Ø¦Ù‚ = 300 Ø«Ø§Ù†ÙŠØ©

		local player = Players.LocalPlayer
		if player and player.Character and player.Character:FindFirstChild("HumanoidRootPart") then
			local root = player.Character.HumanoidRootPart
			local originalPos = root.Position
			root.CFrame = root.CFrame + Vector3.new(0, 0, 1)
			task.wait(0.1)
			root.CFrame = CFrame.new(originalPos)
			print("ğŸš¶ Anti-AFK movement done")
		else
			warn("âŒ Cannot move player for Anti-AFK")
		end
	end
end)

